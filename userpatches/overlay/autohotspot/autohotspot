#!/bin/bash

. /etc/rebuild-settings

enable_hotspot() {
  echo "Enabling wifi hotspot"
  cp /etc/netplan/lib/30-wifi-hotspot.yaml /etc/netplan/
  sed -i 's/@WIFI_SSID@/'${WIFI_SSID}'/g' /etc/netplan/30-wifi-hotspot.yaml
  sed -i 's/@WIFI_PASSWORD@/'${WIFI_PSK}'/g' /etc/netplan/30-wifi-hotspot.yaml
  netplan apply
}

enable_client() {
  echo "Enabling wifi client"
  cp /etc/netplan/lib/20-wifi-client.yaml /etc/netplan/
  sed -i 's/@WIFI_SSID@/'${WIFI_SSID}'/g' /etc/netplan/20-wifi-client.yaml
  sed -i 's/@WIFI_PASSWORD@/'${WIFI_PSK}'/g' /etc/netplan/20-wifi-client.yaml
  netplan apply
}

if [ "${WIFI_TYPE}" == "client" ]; then
  enable_client
elif [ "${WIFI_TYPE}" == "hotspot" ]; then
  enable_hotspot
else
  echo "No Wifi specified"
fi
